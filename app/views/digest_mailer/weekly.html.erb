<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      p { font-family: sans-serif; }
    </style>
  </head>
  <body>
    <p>Hi <%= @user.name %>,</p>
    <p>Here are the top topics from the past week:</p>

    <% @rooms.each do |room| %>
      <% feed_card = room.automated_feed_card %>
      <% source = room.source_room || room %>
      <% icon = room_icon(source.name) %>
      <table cellpadding="0" cellspacing="0" border="0" width="100%%" style="margin-bottom: 12px;">
        <tr>
          <td style="background-color: #f5f5f5; border-radius: 8px; padding: 16px;">
            <p style="margin: 0 0 8px 0; font-family: sans-serif; font-size: 13px; color: #999;">
              <%= icon %> <%= strip_emoji_from_name(source.name) || source.name %>
            </p>
            <%= link_to room_url(room), style: "font-family: sans-serif; font-size: 16px; font-weight: bold; color: #333; text-decoration: none;" do %>
              <%= feed_card&.title || room.name %>
            <% end %>
            <% if feed_card&.summary.present? %>
              <p style="margin: 6px 0 0 0; font-family: sans-serif; font-size: 14px; color: #666; line-height: 1.4;">
                <%= feed_card.summary %>
              </p>
            <% end %>
          </td>
        </tr>
      </table>
    <% end %>

    <p>
      <br/>
      <small>
        --
        <br/>
        To opt out of these emails, click <%= link_to "here", mailkick_unsubscribe_url(@user, "weekly_digest") %>.
      </small>
    </p>
  </body>
</html>
